{% extends "personalproject/base.html" %}
{% load django_tables2 %}

{% block content %}
<body class="bg-light">
  <div class="container-fluid my-3">
    <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å: –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∫–Ω–æ–ø–∫–∏ -->
    <div class="row mb-2">
      <div class="col d-flex justify-content-between align-items-center">
        <h4 class="mb-0"> –†–µ–≥–∏–æ–Ω—ã</h4>
        <div>
          <form action="{% url 'products' %}" method="get">
            <button class="btn btn-primary me-2"  >–°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç–∞–≤–∫–∏</button>
          </form>        
        </div>
      </div>
    </div>

    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –æ–±–ª–∞—Å—Ç–∏ —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏ -->
    <div class="row">
      <div class="col-12">
        <h3 class="text-center">–î–∏–Ω–∞–º–∏–∫–∞ –ø—Ä–æ–¥–∞–∂ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º</h3>
      </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Å–µ—Ç–∫–∞: –°–ª–µ–≤–∞ —Ñ–∏–ª—å—Ç—Ä—ã, —Å–ø—Ä–∞–≤–∞ –æ–±–ª–∞—Å—Ç—å —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏ (–ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º–∞—è) -->
    <div class="row mt-3">
      <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –§–∏–ª—å—Ç—Ä—ã -->
      <div class="col-md-3">
        <form method="GET" action="{% url 'regions_parametrs' %}">
        <!-- –§–∏–ª—å—Ç—Ä—ã: –ü–µ—Ä–∏–æ–¥ -->
        <div class="card mb-3">
          <div class="card-header">–ü–µ—Ä–∏–æ–¥</div>
          <div class="card-body">
         
            <div class="mb-3">
              <label for="startDate" class="form-label">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞</label>
              <input type="date" class="form-control mb-2" name="since" value="{{ request.GET.since }}">
            </div>
            <div class="mb-3">
              <label for="endDate" class="form-label">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</label>
              <input type="date" class="form-control mb-2" name="to" value="{{ request.GET.to }}">
            </div>
          
          </div>
        </div>

        <!-- –§–∏–ª—å—Ç—Ä—ã: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã (–±–µ–∑ –ø–æ–ª—è "–ú–æ–¥–µ–ª—å") -->
        <div class="card mb-2">
          <div class="card-header">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã</div>
          <div class="card-body">
            <div class="mb-2">
              <label for="title" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
              <input type="text" class="form-control mb-2" name="name" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ" value="{{ request.GET.name }}">
            </div>
            <div class="mb-3">
              <label for="article" class="form-label">–ê—Ä—Ç–∏–∫—É–ª</label>
              <input type="text" class="form-control mb-2" name="article" placeholder="–í–≤–µ–¥–∏—Ç–µ –∞—Ä—Ç–∏–∫—É–ª" value="{{ request.GET.article }}">
            </div>
          </div>
        </div>

        
        <div class="card mb-3">
          <div class="card-header">–í—ã–±–æ—Ä —Ä–µ–≥–∏–æ–Ω–æ–≤</div>
          <div class="table-responsive" style="max-height: 180px; overflow-y: auto;">
            <!--<div class="card-body row row-cols-2">-->
            <!-- –°–ø–∏—Å–æ–∫ —Ä–µ–≥–∏–æ–Ω–æ–≤ -->
              <div class="form-check mb-2 col cluster-2">
                <input class="form-check-input cluster-checkbox" type="checkbox" name="clusters" 
                       value="2" id="cluster2">
                <label class="form-check-label" for="cluster2">–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥ –∏ –°–ó–û</label>
              </div>
              <div class="form-check mb-2 col cluster-3">
                  <input class="form-check-input cluster-checkbox" type="checkbox" name="clusters" 
                         value="3" id="cluster3">
                  <label class="form-check-label" for="cluster3">–£—Ä–∞–ª</label>
              </div>  
              <div class="form-check mb-2 col cluster-7">
                <input class="form-check-input cluster-checkbox" type="checkbox" name="clusters" 
                       value="7" id="cluster4">
                <label class="form-check-label" for="cluster4">–î–∞–ª—å–Ω–∏–π –í–æ—Å—Ç–æ–∫</label>
              </div>  
              <div class="form-check mb-2 col cluster-12">
                <input class="form-check-input cluster-checkbox" type="checkbox" name="clusters" 
                       value="12" id="cluster5">
                <label class="form-check-label" for="cluster5">–ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥</label>
              </div>  
              <div class="form-check mb-2 col cluster-16">
                <input class="form-check-input cluster-checkbox" type="checkbox" name="clusters" 
                       value="16" id="cluster6">
                <label class="form-check-label" for="cluster6">–í–æ—Ä–æ–Ω–µ–∂</label>
              </div>  
              <div class="form-check mb-2 col cluster-17">
                <input class="form-check-input cluster-checkbox" type="checkbox" name="clusters" 
                       value="17" id="cluster7">
                <label class="form-check-label" for="cluster7">–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä</label>
              </div>
              <div class="form-check mb-2 col cluster-144">
                <input class="form-check-input cluster-checkbox" type="checkbox" name="clusters" 
                       value="144" id="cluster8">
                <label class="form-check-label" for="cluster8">–¢—é–º–µ–Ω—å</label>
              </div>
              <div class="form-check mb-2 col cluster-146">
                <input class="form-check-input cluster-checkbox" type="checkbox" name="clusters" 
                       value="146" id="cluster8">
                <label class="form-check-label" for="cluster8">–í–æ–ª–≥–æ–≥—Ä–∞–¥</label>
              </div>
              <div class="form-check mb-2 col cluster-147">
                <input class="form-check-input cluster-checkbox" type="checkbox" name="clusters" 
                       value="147" id="cluster9">
                <label class="form-check-label" for="cluster9">–†–æ—Å—Ç–æ–≤</label>
              </div>
              <div class="form-check mb-2 col cluster-148">
                <input class="form-check-input cluster-checkbox" type="checkbox" name="clusters" 
                       value="148" id="cluster10">
                <label class="form-check-label" for="cluster10">–£—Ñ–∞</label>
              </div>
              <div class="form-check mb-2 col cluster-149">
                <input class="form-check-input cluster-checkbox" type="checkbox" name="clusters" 
                       value="149" id="cluster11">
                <label class="form-check-label" for="cluster11">–ö–∞–∑–∞–Ω—å</label>
              </div>
              <div class="form-check mb-2 col cluster-150">
                <input class="form-check-input cluster-checkbox" type="checkbox" name="clusters" 
                       value="150" id="cluster12">
                <label class="form-check-label" for="cluster12">–°–∞–º–∞—Ä–∞</label>
              </div>
              <div class="form-check mb-2 col cluster-151">
                <input class="form-check-input cluster-checkbox" type="checkbox" name="clusters" 
                       value="151" id="cluster13">
                <label class="form-check-label" for="cluster13">–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫</label>
              </div>
              <div class="form-check mb-2 col cluster-152">
                <input class="form-check-input cluster-checkbox" type="checkbox" name="clusters" 
                       value="152" id="cluster14">
                <label class="form-check-label" for="cluster14">–û–º—Å–∫</label>
              </div>
              <div class="form-check mb-2 col cluster-153">
                <input class="form-check-input cluster-checkbox" type="checkbox" name="clusters" 
                       value="153" id="cluster17">
                <label class="form-check-label" for="cluster17">–ö–∞–≤–∫–∞–∑</label>
              </div>
              <div class="form-check mb-2 col cluster-154">
                <input class="form-check-input cluster-checkbox" type="checkbox" name="clusters" 
                       value="154" id="cluster18">
                <label class="form-check-label" for="cluster18">–ú–æ—Å–∫–≤–∞, –ú–û –∏ –î–∞–ª—å–Ω–∏–µ —Ä–µ–≥–∏–æ–Ω—ã</label>
              </div>
              <div class="form-check mb-2 col cluster-155">
                <input class="form-check-input cluster-checkbox" type="checkbox" name="clusters" 
                       value="155" id="cluster19">
                <label class="form-check-label" for="cluster19">–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫</label>
              </div>

            <!--</div>  -->
          </div>
          <div class="card-footer">
            <input type="hidden" name="reg_filter" id="regFilterInput">
            <button type="submit" class="btn btn-primary w-100">üîç –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
          </div>
        </div>
      </form>
      </div>
      <!-- –ì—Ä–∞—Ñ–∏–∫–∏ -->
      <div class="col-md-9">
        <div class="table-responsive" style="max-height: 750px; overflow-y: auto;">
            <div class="container-fluid">
                <div class="row">  <!-- –û—Å–Ω–æ–≤–Ω–æ–π —Ä—è–¥ –¥–ª—è —Å–µ—Ç–∫–∏ -->
                    {% for chart in charts_data %}
                    <div class="col-md-6 col-lg-4 mb-4">  <!-- 3 –≤ —Ä—è–¥ –Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö, 2 –Ω–∞ —Å—Ä–µ–¥–Ω–∏—Ö -->
                        <div class="card h-100 shadow-sm">
                            <div class="card-header bg-light">
                                {{ chart.region_name }}
                            </div>
                            <div class="card-body d-flex flex-column">
                                <div class="chart-wrapper flex-grow-1">
                                    <canvas id="chart-{{ chart.region_id }}"></canvas>
                                </div>
                            </div>
                            <div class="card-footer bg-white">
                                <div class="row text-center">
                                    <div class="col-6 border-end">
                                        <small class="text-muted">–û—Å—Ç–∞—Ç–æ–∫</small>
                                        <p class="mb-0 fw-bold">{{ chart.total_stock }}</p>  
                                    </div>
                                    <div class="col-6">
                                        <small class="text-muted">–•–≤–∞—Ç–∏—Ç –¥–Ω–µ–π</small>
                                        <p class="mb-0 fw-bold">{{ chart.days_end }}</p> 
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ –æ—Å—Ç–∞—Ç–∫–æ–≤ –∏ –ø—Ä–æ–¥–∞–∂ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∞ –Ω–∏–∂–µ –æ–±–ª–∞—Å—Ç–∏ —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏ -->
    <div class="row mt-3">
      <div class="col-12">
        <div class="card">
          <div class="card-header">–¢–∞–±–ª–∏—Ü–∞ –æ—Å—Ç–∞—Ç–∫–æ–≤ –∏ –ø—Ä–æ–¥–∞–∂</div>
          <div class="card-body p-0">
            <div class="table-responsive" style="max-height: 750px; overflow-y: auto;">
              <table class="table table-bordered table-hover table-sm text-center align-middle mb-0">
                {%render_table  region_table%}
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>


<script>
  document.addEventListener('DOMContentLoaded', function() {
    {% for chart in charts_data %}
    new Chart(document.getElementById('chart-{{ chart.region_id }}'), {
      type: 'line',
      data: {
        labels: {{ chart.labels|safe }},
        datasets: [{
          label: '–ü—Ä–æ–¥–∞–∂–∏ ({{ chart.region_name }})',
          data: {{ chart.data|safe }},
          borderColor: "rgba(54, 162, 235, 1)",
          tension: 0.1
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });
    {% endfor %}
  });
</script>

<style>
  .chart-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(500px, 1fr));
    gap: 20px;
    padding: 20px;
  }
  .chart-wrapper {
    background: white;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
</style>

{% endblock %}